<!DOCTYPE html>
<!-- TODO:
Make labels wrap intelligently
Make "about" dialog scroll not overflow
Make map fit to bottom of screen
-->
<html>
<head>
	<title>RabbiMap</title>

	<meta charset="utf-8" />
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	
	<link rel="shortcut icon" type="image/x-icon" href="docs/images/favicon.ico" />

    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.4.0/dist/leaflet.css" integrity="sha512-puBpdR0798OZvTTbP4A8Ix/l+A4dHDD0DGqYW6RQ+9jxkRFclaxxQb/SJAWZfWAkuyeQUytO7+7N4QKrDh+drA==" crossorigin=""/>
    <script src="https://unpkg.com/leaflet@1.4.0/dist/leaflet.js" integrity="sha512-QVftwZFqvtRNi0ZyCtsznlKSWOStnDORoefr1enyq5mVL4tmKB3S/EnC3rRJcxCPavG10IcrVGSmPh6Qw5lwrg==" crossorigin=""></script>
    <script src="https://code.jquery.com/jquery-1.10.2.js"></script>
    <script src="https://code.jquery.com/ui/1.11.1/jquery-ui.js"></script>
    <script src="scripts/csv.js"></script>

<link rel="stylesheet" href="styles.css">
<link rel="stylesheet" href="modal.css">

</head>
<body  dir=ltr >

<table border=0 width="100%" height="100%" cellpadding=0 style="min-height: 100vh;">
<tr><td>
    <b>RabbiMap</b>: Where the rabbis and other great figures in Jewish history lived. <a href="javascript:toggleModal()">Click for explanation</a>
    <span style="float:right">
        Display style: <b>Dots</b>
        <div class="onoffswitch">
            <input type="checkbox" name="onoffswitch" class="onoffswitch-checkbox" id="myonoffswitch" unchecked onClick="changeMode()">
            <label class="onoffswitch-label" for="myonoffswitch">
                <span class="onoffswitch-inner"></span>
                <span class="onoffswitch-switch"></span>
            </label>
        </div>
        <b>Labels</b>
    </span>
<hr noshade>
</td></tr>
<tr><td>
    <div id="mapid" style="width:100%; height:500px;"></div>
</td></tr>
</table>
 
<div id="dialog" title="Basic dialog">
  <p>This is the default dialog which is useful for displaying information. The dialog window can be moved, resized and closed with the 'x' icon.</p>
</div>


<div class="em_wrap_common_public em_wrap_common">
    <div class="modal em-questionnire-container" style="display:none; position: absolute; width: 100%;">
        <div class="overlay"></div>
        <div class="modal_content em-questionnaire-content">
          <span class="modal_close" style="float: right">X</span>
          <div class="em-modal-header"><h2 class="title">About this site:</h2></div>
          <div class="em-modal-text">When we learn Torah, a lot of our time is spent figuring out what exactly the great rabbis were thinking. But of course, Torah thoughts were not the only things on the rabbis' minds. Like people everywhere, they had to deal with many mundane concerns. We can understand many of these concerns by knowing exactly where they lived. For example: What was the weather like and what clothes did they wear? What did they eat? What did they see when they looked out the window? Which roads did they follow to visit their colleagues? Knowing the answers to these questions can make the rabbis feel more real to us, and occasionally provide greater insight into what they are saying.<p>To make this map, I researched numerous tannaim, amoraim, rishonim, achronim, and Biblical figures, and figured out the place (or occasionally several places) where they lived for most of their lives. In cases where they moved around multiple times (very common among the achronim!), I tried to choose the place where they had the most impact, or in connection with which they are best known.<p>The dots have different colors based on the period of the individuals who lived there: <b><font color="red">Biblical</font>, 
<span style="background-color: green"><font color="yellow">tannaim</font></span>, <font color="lime">amoraim</font>, <font color="blue">rishonim/geonim</font>, <font color="silver">acharonim</font>, multiple periods</font></b>.<p>The research I did to create this map was superficial, not deep. If you caught an error, or noticed a name which I left off the map, please contact me at: <img src="email.png" align=top width=150 height=20><p>Enjoy scrolling around the map, and I hope you find it interesting and enlightening!!</div>
          <div class="em-modal-footer"><button id="modal_continue" class="em-btn em-btn-lg em-btn-secondary em-modal-btn">Ok</button></div>
        </div>
      </div>
          </div>
    </div>
</div>


<script>
    var dataImport;
    $.ajax({
            url: './data.csv',
            mimeType: 'text/plain; charset=x-user-defined',
            type: 'get',
            async: false,
            success: function(data) {
                dataImport=CSVToObjects(data, ";");
            }
    });

    function displayLabels() {
        layerGroup.clearLayers();
        for (var i = 0; i < dataImport.length; i++) {
            L.marker(
                [ dataImport[i].Lat, dataImport[i].Long ],
                {icon: L.divIcon({ className: 'my-div-icon',iconSize: null,html:'<div class=marker>'+dataImport[i].Place+": "+dataImport[i].Names+'</div>'}) }
            ).addTo(layerGroup);//addTo(mymap);
        }
    }
    function displayDots() {
        layerGroup.clearLayers();
        for (var i = 0; i < dataImport.length; i++) {
            var circletext;
            if (dataImport[i].Era=='B') circletext='<div class="circle cB"></div>'
            else if (dataImport[i].Era=='T') circletext='<div class="circle cT"></div>'
            else if (dataImport[i].Era=='Am') circletext='<div class="circle cAm"></div>'
            else if (dataImport[i].Era=='R') circletext='<div class="circle cR"></div>'
            else if (dataImport[i].Era=='Ah') circletext='<div class="circle cAh"></div>'
            else circletext='<div class="circle cM"></div>'
            var popuptext='<div class=marker>'+dataImport[i].Place+": "+dataImport[i].Names+'</div>';
            L.marker(
                [ dataImport[i].Lat, dataImport[i].Long ],
                {icon: L.divIcon({ className: 'my-div-icon',iconSize: null,html:circletext}) }
            ).addTo(layerGroup)
            .bindPopup(popuptext)
            .on('mouseover', function (e) { this.openPopup(); });
        }
    }
    function changeMode() {
        var onoffswitch = document.getElementById("myonoffswitch");
        if (onoffswitch.checked == true){
            displayLabels();
        } else {
            displayDots();
        }
    }

    var modal = document.querySelector('.modal');

    var closeModalEls = document.querySelectorAll('.modal_close');

    function attachModalListeners(modalElm) {
      for (var i = 0; i < closeModalEls.length; i++) {
        closeModalEls[i].addEventListener('click', toggleModal);
      }
      document.getElementById('modal_continue').addEventListener('click', toggleModal);
      modalElm.querySelector('.overlay').addEventListener('click', toggleModal);
      document.addEventListener('keyup', escapeKeyExit);
    }

    function detachModalListeners(modalElm) {
      for (var i = 0; i < closeModalEls.length; i++) {
        closeModalEls[i].removeEventListener('click', toggleModal);
      }
      document.getElementById('modal_continue').removeEventListener('click', toggleModal);
      modalElm.querySelector('.overlay').removeEventListener('click', toggleModal);
    }

    function toggleModal() {
      var currentState = modal.style.display;

      // If modal is visible, hide it. Else, display it.
      if (currentState === 'none') {
        modal.style.display = 'block';
        attachModalListeners(modal);
      } else {
        modal.style.display = 'none';
        detachModalListeners(modal);
      }
    }

    function escapeKeyExit(e) {
      var modalOpen = modal.style.display === 'block';
      if (e.keyCode === 27 && modalOpen) {
        toggleModal()
      } else {
        e.preventDefault()
      }
    }

    var usedots=1;
	var mymap = L.map('mapid').setView([44.626,16.708], 5);
	L.tileLayer('https://api.tiles.mapbox.com/v4/{id}/{z}/{x}/{y}.png?access_token=pk.eyJ1IjoibWFwYm94IiwiYSI6ImNpejY4NXVycTA2emYycXBndHRqcmZ3N3gifQ.rJcFIG214AriISLbB6B5aw', {
		maxZoom: 18,
		attribution: 'Map data &copy; <a href="https://www.openstreetmap.org/">OpenStreetMap</a> contributors, ' +
			'<a href="https://creativecommons.org/licenses/by-sa/2.0/">CC-BY-SA</a>, ' +
			'Imagery Â© <a href="https://www.mapbox.com/">Mapbox</a>',
		id: 'mapbox.streets'
	}).addTo(mymap);
    var layerGroup = L.layerGroup().addTo(mymap);
    document.getElementById("myonoffswitch").checked = false;
    displayDots();

</script>

</body>
</html>

